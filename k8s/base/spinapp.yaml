apiVersion: core.spinkube.dev/v1alpha1
kind: SpinApp
metadata:
  name: authorworks-platform
  namespace: authorworks
spec:
  image: "k3d-registry.localhost:5555/authorworks:latest"
  executor: containerd-shim-spin
  enableAutoscaling: false
  replicas: 1
  resources:
    limits:
      cpu: "2"
      memory: "4Gi"
    requests:
      cpu: "500m"
      memory: "1Gi"

  # Environment variables for all components
  variables:
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: authorworks-secrets
          key: database-url
    - name: REDIS_URL
      valueFrom:
        secretKeyRef:
          name: authorworks-secrets
          key: redis-url
    - name: MINIO_ENDPOINT
      value: "http://minio.storage:9000"
    - name: MINIO_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: authorworks-secrets
          key: minio-access-key
    - name: MINIO_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: authorworks-secrets
          key: minio-secret-key
    - name: ALLOWED_ORIGINS
      value: "https://authorworks.leopaska.xyz"
