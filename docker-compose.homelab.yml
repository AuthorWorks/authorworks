networks:
  llm_network:
    external: true

services:
  # API Gateway
  api-gateway:
    image: nginx:alpine
    container_name: authorworks-nginx
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      # Note: UI assets should be built and placed in a dist/ directory
      # - ./dist:/usr/share/nginx/html:ro
    # Note: Service dependencies removed - services are now consolidated
    # depends_on:
    #   - user-service
    #   - content-service
    #   - storage-service
    #   - editor-service
    networks:
      - llm_network
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8080/health || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    labels:
      - "traefik.enable=true"

      # Public landing page route (no auth, highest priority)
      - "traefik.http.routers.authorworks-public.rule=Host(`authorworks.${DOMAIN}`) && PathPrefix(`/`)"
      - "traefik.http.routers.authorworks-public.entrypoints=web,websecure"
      - "traefik.http.routers.authorworks-public.priority=10"
      - "traefik.http.routers.authorworks-public.service=authorworks-service"

      # Protected app routes (with auth, lower priority)
      - "traefik.http.routers.authorworks-app.rule=Host(`authorworks.${DOMAIN}`) && (PathPrefix(`/app`) || PathPrefix(`/api`))"
      - "traefik.http.routers.authorworks-app.entrypoints=web,websecure"
      - "traefik.http.routers.authorworks-app.middlewares=authelia-cloudflare@file"
      - "traefik.http.routers.authorworks-app.priority=20"
      - "traefik.http.routers.authorworks-app.service=authorworks-service"

      # Service definition
      - "traefik.http.services.authorworks-service.loadbalancer.server.port=8080"

  # Note: Individual service repositories have been archived.
  # Services are now consolidated in the main repository and authorworks-engine submodule.
  # Service implementations should be built from the consolidated codebase.
  #
  # Previous service definitions (user-service, content-service, storage-service, editor-service)
  # have been removed. See authorworks-engine for specifications and core functionality.
