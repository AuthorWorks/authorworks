# Optional Prometheus alert rules for AuthorWorks (homelab).
# Add to your Prometheus config (e.g. in homelab-services) under rule_files, or
# load in Grafana Alerting. Requires one of:
#   A) kube-state-metrics in the cluster (recommended), or
#   B) Pod scrape with prometheus.io/scrape annotations on authorworks pods that expose /metrics.
---
groups:
  # Option A: Use with kube-state-metrics (scrape kube-state-metrics from monitoring namespace).
  - name: authorworks-kube-state
    interval: 30s
    rules:
      - alert: AuthorWorksFrontendDown
        expr: kube_deployment_status_replicas_available{namespace="authorworks", deployment="authorworks-frontend"} == 0
        for: 3m
        labels:
          severity: critical
        annotations:
          summary: "AuthorWorks frontend has no available replicas"
      - alert: AuthorWorksBookGeneratorDown
        expr: kube_deployment_status_replicas_available{namespace="authorworks", deployment="authorworks-book-generator"} == 0
        for: 3m
        labels:
          severity: critical
        annotations:
          summary: "AuthorWorks book-generator has no available replicas"
      - alert: AuthorWorksContentWorkerDown
        expr: kube_deployment_status_replicas_available{namespace="authorworks", deployment="authorworks-content-worker"} == 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "AuthorWorks content-worker has no available replicas"

  # Option B: Use if you scrape authorworks pods (prometheus.io/scrape, port, path on pods with /metrics).
  # Uncomment and set job/app labels to match your scrape config (e.g. kubernetes-pods with app label).
  # - name: authorworks-pod-scrape
  #   interval: 30s
  #   rules:
  #     - alert: AuthorWorksFrontendDown
  #       expr: up{kubernetes_namespace="authorworks", app="authorworks-frontend"} == 0
  #       for: 3m
  #       labels:
  #         severity: critical
  #       annotations:
  #         summary: "AuthorWorks frontend scrape target is down"
  #     - alert: AuthorWorksBookGeneratorDown
  #       expr: up{kubernetes_namespace="authorworks", app="authorworks-book-generator"} == 0
  #       for: 3m
  #       labels:
  #         severity: critical
  #       annotations:
  #         summary: "AuthorWorks book-generator scrape target is down"
